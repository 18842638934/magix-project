define("app/views/partials/header-search",["magix","../../menu","$"],function(e,i,t){var r=e("magix");r.applyStyle("p8e",'.p8e-456{box-shadow:0 3px 3px #eee;list-style:none;margin:0;border:1px solid #e6e6e6;border-radius:4px;position:relative;background-color:#fff}.p8e-456:before{top:-7px;border:10px solid transparent;border-top:0;border-bottom:6px solid #e6e6e6}.p8e-456:after,.p8e-456:before{content:"";position:absolute;right:14px;width:0;height:0}.p8e-456:after{top:-6px;border:10px solid transparent;border-top:0;border-bottom:6px solid #fff}.p8e-5a8{color:#666;display:block;padding-left:7px;margin:6px 10px;height:26px;line-height:26px;border-radius:4px;white-space:nowrap}.p8e-5a8:hover{color:#fff;background-color:#8383eb}.p8e-433{float:right;margin-right:89px;position:relative}.p8e-7cb,.p8e-427{position:absolute;top:19px;left:15px;color:#a1a1f0;cursor:pointer}.p8e-7cb{left:auto;right:10px;font-size:14px}.p8e-4f8{width:260px;height:30px;border-radius:30px;border:0;line-height:30px;padding-left:40px;background-color:#5a5ad1;margin-top:10px;color:#e0e0fa!important;transition:border-radius .3s ease-out}.p8e-4f8::-webkit-input-placeholder{color:#b9b9f9}.p8e-4f8::-moz-placeholder{color:#b9b9f9}.p8e-4f8:focus{border-radius:4px}.p8e-456{position:absolute;top:58px;width:258px;left:2px}.p8e-5c3{max-height:326px;overflow:auto}.p8e-5a8:hover{color:#666;background-color:#fff}.p8e-351 .p8e-5a8{color:#fff;background-color:#8383eb}.p8e-456:after,.p8e-456:before{left:14px;right:auto}');var a=e("../../menu"),s=e("$"),o=new r.Cache,p=/[\-#$\^*()+\[\]{}|\\,.?\s]/g,l=function(e){var i=o.get(e);if(!i){var t=["(.*?)("],r=e.split("");if(r.length){for(;r.length;)t.push(r.shift().replace(p,"\\$&"),")(.*?)(");t.pop()}t.push(")(.*?)"),t=t.join("");for(var a=new RegExp(t,"i"),s=[],l=e.length,n=1;l>0;)l--,s.push("$",n,"($",n+1,")"),n+=2;s.push("$",n),o.set(e,i={regexp:a,replacement:s.join("")})}return i},n=function(e){for(var i=a.menu(),t=i.menus,r=[],s=l(e),o=function(e){var i=e.subs;if(i&&i.length)for(var t=0;t<i.length;t++){var a=i[t];s.regexp.test(a.text)||s.regexp.test(a.url)?a.subs?r.push.apply(r,a.subs):r.push(a):o(a)}},p=0;p<t.length;p++){var n=t[p];o(n)}return r},d=function(e,i){var t=s.Deferred();if(e){var r=n(e);t.resolve(r)}else t.resolve([]);return t.promise()};t.exports=r.View.extend({tmpl:{html:'<div mx-guid="g4" class="p8e-433" id="gsearch_<%=$$.viewId%>"><span class="pce-334 p8e-427">&#xe608;</span><span class="pce-334 p8e-7cb p16-ab9" title="清除输入" mx-click="clear()">&#xe68c;</span><input mx-guid="g1" type="text" class="p8e-4f8" mx-input="search()" mx-keyup="search()" mx-paste="search()" mx-focusin="search()" id="sipt_<%=$$.viewId%>" placeholder="搜索..."/><div mx-guid="g3" id="gsearch_result_<%=$$.viewId%>" class="p8e-456<%if(!$$.searchList||!$$.searchList.length){%> p16-ab9<%}%>">2</div></div>',subs:[{s:"2",keys:["viewId","searchList"],tmpl:'<%if($$.searchList&&$$.searchList.length){%><ul mx-guid="g2" mx-mouseout="out()" mx-mousemove="move()" class="p8e-5c3">3</ul><%}%>',path:'div[mx-guid="g3"]',attr:'id="gsearch_result_<%=$$.viewId%>" class="p8e-456<%if(!$$.searchList||!$$.searchList.length){%> p16-ab9<%}%>"',attrs:[{n:"id",p:1},{n:"class",p:1,f:"className"}]},{keys:["viewId"],path:'input[mx-guid="g1"]',attr:'id="sipt_<%=$$.viewId%>"',attrs:[{n:"id",p:1}]},{s:"3",keys:["viewId","searchKeyRegInfo"],tmpl:'<%for(var a=0;a<$$.searchList.length;a++){var b=$$.searchList[a]%><li data-idx="<%=a%>" id="sg_<%!$$.viewId%>_<%!a%>"><a href="#!<%=b.url%>" class="p8e-5a8 p16-9e0" mx-click="hide()" title="<%=b.pathText.join(\'>\')%>"><%=b.pathText[0]%><%for(var c=1;c<b.pathText.length;c++){var d=b.pathText[c]%>&gt;<%!d.replace($$.searchKeyRegInfo.regexp,$$.searchKeyRegInfo.replacement).replace(/\\)\\(/g,\'\').replace(/\\(/g,\'<b>\').replace(/\\)/g,\'</b>\')%><%}%></a></li><%}%>',path:'ul[mx-guid="g2"]',pKeys:["searchList"]},{keys:["viewId"],path:'div[mx-guid="g4"]',attr:'id="gsearch_<%=$$.viewId%>"',attrs:[{n:"id",p:1}]}]},init:function(){this.$idx=-1},render:function(){this.updater.digest({viewId:this.id})},"clear<click>":function(){var e=this,i=s("#gsearch_"+e.id+" input");i.val(""),i.trigger("input")},"search<keyup,paste,input,focusin>":function(e){var i=this,t=i.updater.get("searchList");if("focusin"==e.type&&t&&t.length)return void s("#gsearch_result_"+i.id).removeClass("p16-ab9");var a=s.trim(e.eventTarget.value),o=a?"removeClass":"addClass";if(s("#gsearch_"+i.id+" .p8e-7cb")[o]("p16-ab9"),"keyup"==e.type&&t&&t.length)if(s("#gsearch_result_"+i.id).removeClass("none"),40==e.keyCode)i.normal(),i.$idx++,i.$idx>=t.length&&(i.$idx=0),i.highlight();else if(38==e.keyCode)i.normal(),i.$idx--,i.$idx<0&&(i.$idx=t.length-1),i.highlight();else if(13==e.keyCode){var p=s("#sg_"+i.id+"_"+i.$idx);if(p&&p.length){var n=p.find("a").attr("href").slice(2);r.Router.to(n),i.hideSearchList(),s("#sipt_"+i.id).blur()}}clearTimeout(i.$sTimer),i.$sTimer=setTimeout(i.wrapAsync(function(){var t=s.trim(e.eventTarget.value);t!=i.$sValue&&(i.$idx=-1,i.$sValue=t,d(t).then(function(e){i.updater.digest({searchKeyRegInfo:l(t),searchList:e})}))}),300)},normal:function(){var e=this;s("#sg_"+e.id+"_"+e.$idx).removeClass("p8e-351")},highlight:function(e){var i=this,t=s("#sg_"+i.id+"_"+i.$idx);if(t.addClass("p8e-351"),!e&&t.length){i.$ignore=1;var r=32.6*(i.$idx+1),a=s("#gsearch_result_"+i.id+" ul"),o=a.height(),p=a.prop("scrollTop"),l=Math.ceil(o/32.6);r<p+32.6?a.prop("scrollTop",r-32.6):r>p+o&&a.prop("scrollTop",32.6*(i.$idx+2-l))}},hideSearchList:function(){var e=this;s("#gsearch_result_"+e.id).addClass("p16-ab9"),e.normal(),e.$idx=-1},"hide<click>":function(){this.hideSearchList()},"out<mouseout>":function(e){if(!r.inside(e.relatedTarget,e.eventTarget)){var i=this;i.normal(),i.$idx=-1}},"move<mousemove>":function(e){var i=this;if(i.$ignore)return void delete i.$ignore;var t=s(e.target);if(t.is("a")&&(t=t.parent()),t.is("li")){var r=t.data("idx");r!=i.$idx&&(i.normal(),i.$idx=r,i.highlight(!0))}},"$doc<click>":function(e){var i=this;r.inside(e.target,"gsearch_"+i.id)||i.hideSearchList()}})});