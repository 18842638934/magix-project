define("app/views/partials/nav",["magix","$","../../menu"],function(e,t,i){var s=e("magix"),n=e("$");s.applyStyle("p4b",'.p4b-nav{position:relative;z-index:399;background:#000;width:160px;height:100%;font-size:14px;transition:width .3s ease-out;transform:translateZ(0);float:left}.p4b-5ca{background:#3e4048;width:100%;left:0;direction:rtl}.p4b-5ca,.p4b-1b0{height:100%;position:absolute;padding-top:40px;top:0;overflow:auto}.p4b-1b0{background:#31323d;width:200px;padding-bottom:42px;left:160px}.p4b-9d4{background-color:#3e4048;cursor:pointer;border-left:4px solid transparent;overflow:hidden;margin-bottom:14px;height:40px}.p4b-9d4:hover .p4b-5b9{color:hsla(0,0%,100%,.3)}.p4b-02d{opacity:.6}.p4b-1fd,.p4b-986{background:#32323d;border-left-color:#6364e5}.p4b-1fd .p4b-5b9,.p4b-986 .p4b-5b9{color:hsla(0,0%,100%,.3)}.p4b-1fd .p4b-c74:before,.p4b-986 .p4b-c74:before{content:"\\e789"}.p4b-5b9{display:block;float:left}.p4b-2eb{width:66px;font-size:14px;text-align:left;color:hsla(0,0%,100%,.45)}.p4b-530,.p4b-c74,.p4b-2eb{height:40px;line-height:40px;float:left}.p4b-530,.p4b-c74{color:hsla(0,0%,100%,.5)}.p4b-530{width:54px;text-align:left;padding-left:25px}.p4b-c74{width:36px;text-align:right;padding-right:15px}.p4b-c74:before{content:"\\e692"}.p4b-b63{padding:0 10px 0 20px}.p4b-0c3{float:right;width:40px;text-align:center}.p4b-dae,.p4b-0c3{height:40px;line-height:40px}.p4b-dae{color:#7f7f89;margin-bottom:4px}.p4b-d15{padding-left:10px}.p4b-b6e{display:block;padding:10px 0;color:#afafbc}.p4b-040,.p4b-b6e:active,.p4b-b6e:focus,.p4b-b6e:hover{color:#8787ea}.p4b-040 .p4b-485,.p4b-b6e:active .p4b-485,.p4b-b6e:focus .p4b-485,.p4b-b6e:hover .p4b-485{color:#8b8bed}.p4b-485{color:#a1a1b2;float:left;width:20px;margin-top:3px}.p4b-0df{display:block;margin-left:20px}.p4b-508{width:50px}.p4b-508 .p4b-c74,.p4b-508 .p4b-2eb{display:none}.p4b-508 .p4b-530{width:46px;padding-left:0;text-align:center}.p4b-508 .p4b-1b0{left:50px}');var a=e("../../menu"),p=a.menu(),o=p.menus,d=p.urlsToMainMap,u=p.subsMap,l=p.menusMap,b={triangle:{m:{x:-1,y:-1},n:{x:-1,y:0},p:{x:-1,y:-1}},getVirtualCoordinate:function(e){var t=this,i=t.$node.offset();return{x:e.pageX-i.left,y:t.$node.outerHeight()-(e.pageY-i.top)}},update:function(e){var t=this,i=t.triangle;t.$node=e;var s=e.outerWidth();i.m.x=s,i.m.y=e.outerHeight(),i.n.x=s},updatePoint:function(e){var t=this;t.triangle.p=t.getVirtualCoordinate(e)},isInTriangle:function(e){var t=this,i=t.getVirtualCoordinate(e),s=t.triangle;return i.x>s.m.x||i.x>=s.p.x&&(i.y>=s.p.y&&(s.m.y-i.y)/(s.m.x-i.x)>=(s.m.y-s.p.y)/(s.m.x-s.p.x)||i.y<s.p.y&&(s.n.y-i.y)/(s.n.x-i.x)<(s.n.y-s.p.y)/(s.n.x-s.p.x))}};i.exports=s.View.extend({tmpl:{html:'<div mx-guid="g1" class="p4b-5ca p16-3d3" mx-mouseout="hideSubs()" mx-mouseover="stopHide()" id="main_<%=$$.viewId%>" mx-contextmenu="preventHide()"><ul mx-guid="g0">2</ul></div><div mx-guid="g3" class="p16-3d3 p16-d72 p4b-1b0<%if(!$$.showSub){%> p16-ab9<%}%>" id="subs_<%=$$.viewId%>" mx-mouseout="hideSubs()" mx-mouseover="stopHide()" mx-contextmenu="preventHide()">3</div>',subs:[{s:"2",keys:["menus"],tmpl:'<li class="p4b-9d4 p16-c8d" data-key="index" mx-mouseover="startShowSubs()" mx-mousemove="showSubs()"><a class="p4b-5b9 p16-c8d" href="#!/index" hidefocus="true"><span class="p4b-530 pce-334">&#xe69c;</span><span class="p4b-2eb">首页</span></a></li><%for(var i=0,menu;i<$$.menus.length;i++){menu=$$.menus[i]%><li class="p4b-9d4 p16-c8d" data-key="<%=menu.key%>" mx-mouseover="startShowSubs({key:\'<%=menu.key%>\'})" mx-mousemove="showSubs({key:\'<%=menu.key%>\'})"><a class="p4b-5b9" href="#!<%=menu.url%>" hidefocus="true"><span class="p4b-530 pce-334"><%!menu.icon%></span><span class="p4b-2eb"><%=menu.text%></span></a><span class="p4b-c74 pce-334"></span></li><%}%>',path:'ul[mx-guid="g0"]'},{keys:["viewId"],path:'div[mx-guid="g1"]',attr:'id="main_<%=$$.viewId%>"',attrs:[{n:"id",p:1}]},{s:"3",keys:["showSub","viewId","subs"],tmpl:'<%if($$.subs){%><ul><%for(var j=0,subMenu;j<$$.subs.length;j++){subMenu=$$.subs[j];if(subMenu.subs&&subMenu.subs.length){%><li class="p4b-b63"><div class="p4b-dae p16-cp" <%if(subMenu.canFolder){%> mx-click="toggleSubMenus({key:\'<%=subMenu.key%>\'})" <%}%>><%=subMenu.text%> <%if(subMenu.canFolder){%><i class="pce-334 p4b-0c3"><%if(subMenu.folderExpand){%> &#xe786; <%}else{%> &#xe692; <%}%></i><%}%></div><ul class="p4b-d15" <%if(subMenu.canFolder&&!subMenu.folderExpand){%> style="display:none" <%}if(subMenu.canFolder){%> data-toggle-menu="true" <%}%>><%for(var x=0,item;x<subMenu.subs.length;x++){item=subMenu.subs[x]%><li><a <%if(item.url){%>href="#!<%=item.url%>" <%}else{%>href="javascript:;" <%}%> class="p4b-b6e"><i class="pce-334 p4b-485"><%!item.icon%></i><span class="p4b-0df"><%=item.text%></span></a></li><%}%></ul></li><%}else{%><li class="p4b-b63"><a href="#!<%=subMenu.url%>" class="p4b-b6e"><i class="pce-334 p4b-485" style="margin-right: 5px"><%!subMenu.icon%></i><%=subMenu.text%></a></li><%}}%></ul><%}%>',path:'div[mx-guid="g3"]',attr:'class="p16-3d3 p16-d72 p4b-1b0<%if(!$$.showSub){%> p16-ab9<%}%>" id="subs_<%=$$.viewId%>"',attrs:[{n:"class",p:1,f:"className"},{n:"id",p:1}],mask:"221"}]},init:function(){var e=this;s.Router.on("changed",function(){e.highlight(),e.highlightSub()})},render:function(){var e=this,t=n("#"+e.id);t.addClass("p4b-nav"),e.$node=t,e.updater.digest({viewId:e.id,menus:o}),e.$subs=n("#subs_"+e.id),b.update(e.$node),e.highlight()},highlight:function(){var e=s.Router.parse(),t=e.path;d[t]||(t=t.replace(/\-[^-]+$/,""));var i=d[t];"/index"==t&&(i="index");var a=this,p=n("#main_"+a.id);p.find("li").removeClass("p4b-986").removeClass("p4b-02d"),a.$mainMenu=p.find("[data-key="+i+"]").addClass("p4b-986"),a.$mainMenuKey=i},highlightSub:function(){var e=this,t=s.Router.parse(),i=t.path;d[i]||(i=i.replace(/\-[^-]+$/,"")),e.$subs.find("a").removeClass("p4b-040");var n=e.$subs.find('[href="#!'+i+'"]').addClass("p4b-040"),a=n.parents("ul");if("none"==a.css("display")){var p=a.prev("div[mx-click]");p.length&&p.trigger("click")}},toggleSubs:function(e,t,i){var s=this;i=e,e||(i="index"),i!=s.$mainMenuKey?s.$mainMenu.addClass("p4b-02d"):s.$mainMenu.removeClass("p4b-02d");var a=e+"?"+!!e;if(s.$flag!=a){if(s.$flag=a,s.$menu&&s.$menu.removeClass("p4b-1fd"),e&&s.$key!=e){s.$key=e;var p=l[e];s.updater.set({subs:p})}s.$menu=n(t).addClass("p4b-1fd"),s.updater.digest({showSub:!!e}),e&&s.highlightSub()}},hideSubs:function(e){var t=this;delete t.$preventHide;var i=function(){t.$menu&&(t.$menu.removeClass("p4b-1fd"),t.$mainMenu.removeClass("p4b-02d"),delete t.$menu),delete t.$flag,t.updater.digest({showSub:!1})};e?(console.log("immediately hide"),i()):t.$hideTimer=setTimeout(i,100)},"startShowSubs<mouseover>":function(e){if(!s.inside(e.relatedTarget,e.eventTarget)){var t=this;b.updatePoint(e),clearTimeout(t.$showTimer);var i=e.eventTarget,n=e.params.key,a=t.updater.get("showSub");n&&!a?t.toggleSubs(n,i):t.$showTimer=setTimeout(function(){t.toggleSubs(n,i)},200)}},"stopHide<mouseover>":function(e){if(!s.inside(e.relatedTarget,e.eventTarget)){var t=this;clearTimeout(t.$hideTimer)}},"hideSubs<mouseout>":function(e){if(!s.inside(e.relatedTarget,e.eventTarget)){var t=this;if(t.$preventHide)return void delete t.$preventHide;clearTimeout(t.$showTimer),t.hideSubs()}},"toggleSubMenus<click>":function(e){var t=n(e.eventTarget),i=u[e.params.key];t.hasClass("iconfont")&&(t=t.parent());var s=t.next(),a=t.find(".iconfont");"none"==s.css("display")?(i.folderExpand=!0,s.slideDown(),a.html("&#xe786;")):(i.folderExpand=!1,s.slideUp(),a.html("&#xe692;"))},"showSubs<mousemove>":function(e){var t=this;b.isInTriangle(e)||t.toggleSubs(e.params.key,e.eventTarget)},"preventHide<contextmenu>":function(){var e=this;if(e.$preventHide=!0,!e.$listened){e.$listened=!0;var t=n(document),i=function(n){s.inside(n.target,e.id)||(delete e.$listened,t.off("mousemove mouseup",i),e.hideSubs(!0))};t.on("mousemove mouseup",i)}},"$doc<navslide>":function(){this.$node.toggleClass("p4b-508")},"$doc<navslidend>":function(){console.log("update triangle"),b.update(this.$node)},"$win<resize>":function(){console.log("update triangle"),b.update(this.$node)}})});