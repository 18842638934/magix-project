define("app/services/service",["magix","$","./preservice","./project"],function(e,t,r){var i=e("magix"),c=e("$"),n=e("./preservice"),s=e("./project"),o=function(e,t){if(n.intervene())n.addService(o,e,t);else{if(e.get("mock")){e.get("ctrl")?e.set("ctrl",""):e.set("url","./tmpl/apis/list2.json")}c.ajax({url:e.get("url")+"?r="+i.guid(),complete:function(r,i){if("error"==i)t({msg:r.statusText});else{var s=c.parseJSON(r.responseText);s.action?(n.addService(o,e,t),n.addTask(s.action)):(e.set("data",s),t())}}})}},a=i.Service.extend(o);s(a),i.mix(a,{ctor:function(){var e=this;e.on("rendercall",function(){delete e.$locker})},request:function(e){e=e||i.guid("r");var t=new a;return this.capture(e,t,!0),t},fetch:function(e,t){this.request().all(e,t)},save:function(e,t){var r=this,i=JSON.stringify(e);r.lock(i,function(){r.request(i+"_request").save(e,function(){r.unlock(i),t.apply(r,arguments)})})},lock:function(e,t){var r=this;r.$locker||(r.$locker={});var i=r.$locker;i[e]||(i[e]=t,t())},unlock:function(e){var t=this.$locker;t&&delete t[e]}}),r.exports=a});