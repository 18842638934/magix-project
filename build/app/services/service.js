define("app/services/service",["magix","$","./preservice","./project"],function(e,t,r){var c=e("magix"),i=e("$"),n=e("./preservice"),o=e("./project"),s=function(e,t){if(n.intervene())n.addService(s,e,t);else{if(e.get("mock")){e.get("ctrl")?e.set("ctrl",""):e.set("url","./tmpl/apis/list2.json")}i.ajax({url:e.get("url")+"?r="+c.guid(),complete:function(r,c){if("error"==c)t({msg:r.statusText});else{var o=i.parseJSON(r.responseText);o.action?(console.log("need",o.action),n.addService(s,e,t),n.addTask(o.action)):(e.set("data",o),t())}}})}},a=c.Service.extend(s);o(a),c.mix(a,{ctor:function(){var e=this;e.on("rendercall",function(){delete e.$locker})},request:function(e){e=e||c.guid("r");var t=new a;return this.capture(e,t,!0),t},fetch:function(e,t){this.request().all(e,t)},save:function(e,t){var r=this,c=JSON.stringify(e);r.lock(c,function(){r.request(c+"_request").save(e,function(){r.unlock(c),t.apply(r,arguments)})})},lock:function(e,t){var r=this;r.$locker||(r.$locker={});var c=r.$locker;c[e]||(c[e]=t,t())},unlock:function(e){var t=this.$locker;t&&delete t[e]}}),r.exports=a});