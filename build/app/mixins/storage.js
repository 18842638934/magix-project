define("app/mixins/storage",["magix"],function(t,e,a){var o,r,i,n=t("magix"),s={},d=!1,c={};r="localStorage";var l=function(){var t=(+new Date).toString(),e=JSON.stringify(c);s.store=e,s.update=t,"behavior"==r&&(i.setAttribute("update",t),i.setAttribute("storage",e),i.save("storage"))},g=n.mix({set:function(t,e){c[t]=e,l()},get:function(t){return c[t]},del:function(t){delete c[t],l()}},n.Event);if(r in window)try{localStorage.setItem(r,n.guid()),d=!0,localStorage.removeItem(r)}catch(t){}if(d)s=localStorage,o=s.update;else if((r="globalStorage")in window)try{var u=window[r];s="localhost"==location.hostname?u["localhost.localdomain"]:u[location.hostname],o=s.update}catch(t){}else if(i=document.createElement("link"),i.addBehavior){i.style.behavior="url(#default#userData)",document.getElementsByTagName("head")[0].appendChild(i);try{i.load("storage")}catch(t){i.setAttribute("storage","{}"),i.save("storage"),i.load("storage")}var v="{}";try{v=i.getAttribute("storage"),o=i.getAttribute("update")}catch(t){}r="behavior",s.store=v}var f=function(){var t;clearTimeout(f.timer),f.timer=setTimeout(function(){if("behavior"==r){i.load("storage");try{t=i.getAttribute("update")}catch(t){}}else t=s.update;if(t&&t!=o){o=t;var e=void 0,a="{}";if("behavior"==r){i.load("storage");try{a=i.getAttribute("storage")}catch(t){}s.store=a}e=JSON.parse(s.store);for(var d=n.keys(c).concat(n.keys(e)),l={},u=0,v=d;u<v.length;u++){var f=v[u];if(1!==l[f]){l[f]=1;var h=JSON.stringify(c[f]);JSON.stringify(e[f])!=h&&g.fire("change",{key:f,from:c[f],to:e[f]})}}c=e}},25)};if("addEventListener"in window&&window.addEventListener("pageshow",function(t){t.persisted&&f()},!1),"behavior"==r?setInterval(f,1e3):"addEventListener"in window?window.addEventListener("storage",f,!1):document.attachEvent("onstorage",f),s.store)try{c=JSON.parse(s.store)}catch(t){s.store="{}"}else s.store="{}";a.exports=g});