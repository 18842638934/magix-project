define("app/gallery/mx-validation/index",["magix","$"],function(e,t,r){var a=e("magix"),n=e("$"),i=a.Vframe;a.applyStyle("p70",".p70-pr{position:relative}.p70-ea5,.p70-ea5:hover{border-color:#a62a22!important}.p70-msg,.p70-adf{display:none;line-height:18px;border-radius:4px;padding:4px 8px;position:absolute;background:#fff;white-space:nowrap;word-wrap:normal;z-index:1;pointer-events:none;color:#666;font-size:12px}.p70-adf{line-height:22px;border:1px solid #e6e6e6}");var o=function(e){return e.replace(/[^\x00-\xff]/g,"xl").length},u=function(e){for(var t;e&&e!=document;){var r=e.id;if(r&&(t=i.get(r)))break;e=e.parentNode}return t},s=["required","number","length","blength","range","equalto","pattern"],d={required:function(e,t){return"true"!=t||n.trim(e)},number:function(e,t){return!(e=n.trim(e))||"true"!=t||e.indexOf(".")==e.lastIndexOf(".")&&/^[\d\.]+$/.test(e)},length:function(e,t){return t=n.parseJSON(t),!(e.length<t[0]||e.length>t[1])},blength:function(e,t){t=n.parseJSON(t);var r=o(e);return!(r<t[0]||r>t[1])},range:function(e,t){return t=n.parseJSON(t),!((e=parseFloat(e))<t[0]||e>t[1])},equalto:function(e,t){return n(t).val()==e},pattern:function(e,t){if(e=n.trim(e)){return new RegExp(t).test(e)}return!0}},f={required:function(){return"亲，此项必填哦～"},number:function(){return"亲，请输入数字哦～"},length:function(e){return e=n.parseJSON(e),"亲，此项长度不能小于"+e[0]+"，也不能大于"+e[1]+"哦～"},blength:function(e){return e=n.parseJSON(e),"亲，此项长度不能小于"+e[0]+"个字符，也不能大于"+e[1]+"个字符哦～"},range:function(e){return e=n.parseJSON(e),"亲，请输入"+e[0]+"-"+e[1]+"之间的数字哦～"},equalto:function(e){return"亲，请与"+e+"填写同样的内容～"},pattern:function(){return"亲，输入格式有误～"}},p={msg:function(e,t){var r=e.attr("id");r||(r=a.guid(),e.attr("id",r));var i=r+"_msg",o=n("#"+i);if(!t)return void o.hide();o.length||(e.wrap('<div class="p16-ib" />'),e.parent().addClass("p70-pr"),e.before('<div class="p70-msg" id="'+i+'"/>'),o=n("#"+i)),o.html(t).show();var u,s=e.offset(),d=e.attr("validator-message-type"),f=s.top;if("outer"==d){o.addClass("p70-adf");switch(e.attr("validator-message-placement")){case"top":u=s.left,f=s.top-e.outerHeight()-5;break;case"bottom":u=s.left,f=s.top+e.outerHeight()+5;break;default:u=s.left+e.outerWidth()+10}}else u=s.left-o.outerWidth()+e.outerWidth()-1,f+=3;var p=e.attr("validator-message-offset");p&&(p=n.parseJSON(p),u+=p[0],f+=p[1]),o.offset({left:u,top:f})},hideMsg:function(e){e=n(e);var t=e.attr("id");t||(t=a.guid(),e.attr("id",t)),n("#"+t+"_msg").hide()},ctrl:function(e,t){t?(e.addClass("p70-ea5"),p.msg(e,e.attr("validator-"+t+"-message"))):(e.removeClass("p70-ea5"),p.msg(e))}};r.exports=a.View.extend({one:function(e,t){e=n(e);var r=this,a=!1,i=e.data("owner");if(i||e.attr("data-owner",i=r.id),i==r.id){for(var o=0;o<s.length;o++){var u=s[o],l=e.attr("validator-"+u);if(l){var c=d[u];if(c&&!(c=c(t||e.val(),l))){a=u;var g=e.attr("validator-"+u+"-message");g||(g=f[u](l),e.attr("validator-"+u+"-message",g));break}}}p.ctrl(e,a)}return a},isValid:function(){var e=this,t=!0;return n("#"+e.id+" input,#"+e.id+" textarea,#"+e.id+" [mx-view],#"+e.id+" [validator]").each(function(r,a){var i=n(a);if(!i.data("owner")){var o=u(a.parentNode);o&&i.attr("data-owner",o.id)}e.one(a)&&(t=!1)}),t},'$div[class="p70-msg"]<click>':function(e){if("outer"!=n(e.eventTarget).attr("validator-message-type")){var t=e.eventTarget.id,r=a.node(t.replace(/_msg$/,""));r&&"INPUT"==r.tagName&&(r.select(),r.focus())}},"$input,textarea,[mx-view]<keyup,change,focusin,focusout>":function(e){var t=this,r=e.eventTarget;e.verify||(clearTimeout(r.timer),e.verify=t.id,"focusin"==e.type?p.hideMsg(r):r.timer=setTimeout(t.wrapAsync(function(){t.one(r)}),20))}})});