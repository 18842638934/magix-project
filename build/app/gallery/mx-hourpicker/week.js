define("app/gallery/mx-hourpicker/week",["magix","$","../mx-monitor/index","./index"],function(e,i,t){var a=e("magix"),d=e("$"),s=e("../mx-monitor/index");a.applyStyle("pe8",".pe8-f9d{font-size:12px}.pe8-b45{height:60px;line-height:60px;vertical-align:middle;color:#333;padding-left:30px}.pe8-e60{margin-right:50px}.pe8-05c{width:100%;max-width:100%;margin-bottom:20px}.pe8-4ae{padding-left:30px}.pe8-e0c{background-color:#fafafa;color:#999}.pe8-ec7{position:relative}.pe8-f6f{display:inline-block;position:absolute;top:50%;margin-top:-9px;width:32px;height:18px}.pe8-84e{left:8px}.pe8-33d{left:24%}.pe8-025{left:47.5%}.pe8-d3c{left:71%}.pe8-b9c{left:94%}.pe8-day{border-top:1px solid #eee}.pe8-day td{padding:0 10px}.pe8-day:first-child{border-top:none}.pe8-day .pe8-458{vertical-align:middle;cursor:default;padding-left:30px}.pe8-fb7{visibility:hidden}tr:hover .pe8-fb7{visibility:visible}.pe8-e16{position:absolute;display:none;background-color:#fff;border:1px solid #e6e6e6;border-radius:4px;outline:0;padding:20px 20px 10px;margin-top:10px;z-index:10}.pe8-551{margin-bottom:20px;width:300px;border-bottom:1px solid #e6e6e6}.pe8-83d{margin-bottom:10px;margin-right:28px}.pe8-b1c{visibility:visible}");var n=e("./index"),p="111111111111111111111111",c="000000000000000000000000",r=function(e){for(var i=0;i<7;)e[i]=n.improve(e[i]),i++;return e};t.exports=a.View.extend({tmpl:{html:'<div class="pe8-f9d"><div mx-guid="g7" class="pe8-e16" id="dlg_<%=$$.viewId%>"><div mx-guid="g6" class="pe8-551">2</div><div><button type="button" class="pf0-btn pf0-046" mx-click="apply()">确认</button><button type="button" mx-click="closeDlg()" class="pf0-btn p16-ml5">取消</button></div></div><div class="pe8-b45"><label class="pe8-e60"><input mx-guid="gb" class="p16-mr5" type="radio" mx-click="st({type:0})" name="st-<%=$$.viewId%>" <%if($$.allDays){%> checked<%}%>/> 全日程投放</label><label class="pe8-e60"><input mx-guid="gc" class="p16-mr5" type="radio" mx-click="st({type:1})" name="st-<%=$$.viewId%>" <%if($$.weekdays){%> checked<%}%>/> 工作日（周一至周五）投放</label><label><input mx-guid="gd" class="p16-mr5" type="radio" mx-click="st({type:2})" name="st-<%=$$.viewId%>" <%if($$.weekends){%> checked<%}%>/> 休息日（周六、周日）投放</label></div><table class="pe8-05c"><thead><tr class="pe8-e0c"><td width="160" class="pe8-4ae">时间段</td><td class="pe8-ec7"><span class="pe8-f6f pe8-84e">0:00</span><span class="pe8-f6f pe8-33d">6:00</span><span class="pe8-f6f pe8-025">12:00</span><span class="pe8-f6f pe8-d3c">18:00</span><span class="pe8-f6f pe8-b9c">24:00</span></td><td width="160" align="center">操作</td></tr></thead><tbody mx-guid="ge">3</tbody></table></div>',subs:[{s:"2",keys:["currentClone"],tmpl:'<%for(var i = 0; i < $$.days.length; i++){%><label class="pe8-83d<%if(i==$$.currentClone){%> p2c-864<%}%>"><input class="p16-fdc" type="checkbox" value="<%=i%>" <%if(i==$$.currentClone){%> disabled<%}%>/>周<%=$$.days.charAt(i)%></label><%}%>',path:'div[mx-guid="g6"]'},{keys:["viewId"],path:'div[mx-guid="g7"]',attr:'id="dlg_<%=$$.viewId%>"',attrs:[{n:"id",p:1}]},{s:"3",keys:["viewId"],tmpl:'<%for(var i = 0; i < $$.days.length; i++){%><tr class="pe8-day"><td class="pe8-458" mx-click="toggle({day:<%=i%>})">周<%=$$.days.charAt(i)%></td><td id="hours_<%=$$.viewId%>_<%=i%>" mx-view="app/gallery/mx-hourpicker/index" mx-change="hour({day:<%=i%>})"></td><td align="center"><div class="pe8-fb7"><a mx-click="copy({day:<%=i%>})" href="javascript:;">复制到</a></div></td></tr><%}%>',path:'tbody[mx-guid="ge"]'},{keys:["viewId","allDays"],path:'input[mx-guid="gb"]',attr:'name="st-<%=$$.viewId%>" <%if($$.allDays){%> checked<%}%>',attrs:[{n:"name"},{n:"checked",b:1,p:1}]},{keys:["viewId","weekdays"],path:'input[mx-guid="gc"]',attr:'name="st-<%=$$.viewId%>" <%if($$.weekdays){%> checked<%}%>',attrs:[{n:"name"},{n:"checked",b:1,p:1}]},{keys:["viewId","weekends"],path:'input[mx-guid="gd"]',attr:'name="st-<%=$$.viewId%>" <%if($$.weekends){%> checked<%}%>',attrs:[{n:"name"},{n:"checked",b:1,p:1}]}]},init:function(e){var i=this;i.$days=e.days||[c,c,c,c,c,c,c],i.$days=r(i.$days),s.setup(),i.on("destroy",s.teardown)},render:function(){var e=this;e.updater.digest({viewId:e.id,days:"一二三四五六日"}),e.val(e.$days)},inside:function(e){var i=this,t=a.inside(e,"dlg_"+i.id);if(!t&&i.$ref){var d=i.$ref.parent();t=a.inside(e,d[0])}return t},syncShortcuts:function(){var e=this,i=e.$days.slice(0,5).join(""),t=e.$days.slice(-2).join(""),a=i.indexOf("1")>-1,d=t.indexOf("1")>-1,s=-1==i.indexOf("0"),n=-1==t.indexOf("0"),p=s&&n;e.updater.digest({allDays:p,weekdays:!d&&s,weekends:n&&!a})},syncUI:function(){for(var e=this,i=e.$days,t=0,d=void 0,s=void 0;t<i.length;t++)d=i[t],(s=a.Vframe.get("hours_"+e.id+"_"+t))&&s.invoke("val",[d])},val:function(e){var i=this;return e&&(i.$days=r(e),i.syncUI(),i.syncShortcuts()),i.$days},show:function(){var e=this;if(!e.$shown){e.$shown=!0,s.add(e);var i=e.$ref,t=d("#dlg_"+e.id);t.show();var a=i.offset(),n=a.left+i.outerWidth()-t.outerWidth(),p=a.top+i.outerHeight()+10;t.offset({left:n,top:p}),i.parent().addClass("pe8-b1c")}},hide:function(){var e=this;if(e.$shown){e.$shown=!1,s.remove(e),d("#dlg_"+e.id).hide();var i=e.$ref;i&&i.parent().removeClass("pe8-b1c")}},"st<click>":function(e){var i=this;switch(e.params.type){case 0:i.$days=[p,p,p,p,p,p,p];break;case 1:i.$days=[p,p,p,p,p,c,c];break;case 2:i.$days=[c,c,c,c,c,p,p]}i.syncShortcuts(),i.syncUI()},"hour<change>":function(e){var i=this;i.$days[e.params.day]=e.range,clearTimeout(i.$timer),i.$timer=setTimeout(i.wrapAsync(function(){i.syncShortcuts()}),100)},"toggle<click>":function(e){var i=e.params.day,t=this,d=a.Vframe.get("hours_"+t.id+"_"+i);if(d){d.invoke("val").indexOf("0")>-1?d.invoke("val",[t.$days[i]=p]):d.invoke("val",[t.$days[i]=c]),t.syncShortcuts()}},"copy<click>":function(e){var i=this,t=d(e.eventTarget);i.$ref=t,i.show(),i.updater.digest({currentClone:e.params.day})},"closeDlg<click>":function(){this.hide()},"apply<click>":function(){var e=this,i=e.updater.get("currentClone"),t=e.$days[i];d("#dlg_"+e.id+" input:checked").each(function(i,a){e.$days[a.value]=t}),e.hide(),e.syncUI(),e.syncShortcuts()}})});