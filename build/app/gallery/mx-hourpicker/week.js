define("app/gallery/mx-hourpicker/week",["magix","$","../mx-monitor/index","./index"],function(e,a,d){var i=e("magix"),t=e("$"),c=e("../mx-monitor/index");i.applyStyle("pabcde8",".pabcde8-f9d{font-size:12px}.pabcde8-b45{height:60px;line-height:60px;vertical-align:middle;color:#333;padding-left:30px}.pabcde8-e60{margin-right:50px}.pabcde8-05c{width:100%;max-width:100%;margin-bottom:20px}.pabcde8-4ae{padding-left:30px}.pabcde8-e0c{background-color:#fafafa;color:#999}.pabcde8-ec7{position:relative}.pabcde8-f6f{display:inline-block;position:absolute;top:50%;margin-top:-9px;width:32px;height:18px}.pabcde8-84e{left:8px}.pabcde8-33d{left:24%}.pabcde8-025{left:47.5%}.pabcde8-d3c{left:71%}.pabcde8-b9c{left:94%}.pabcde8-day{border-top:1px solid #eee}.pabcde8-day td{padding:0 10px}.pabcde8-day:first-child{border-top:none}.pabcde8-day .pabcde8-458{vertical-align:middle;cursor:default;padding-left:30px}.pabcde8-fb7{visibility:hidden}tr:hover .pabcde8-fb7{visibility:visible}.pabcde8-e16{position:absolute;display:none;background-color:#fff;border:1px solid #e6e6e6;border-radius:4px;outline:0;padding:20px 20px 10px;margin-top:10px;z-index:10}.pabcde8-551{margin-bottom:20px;width:300px;border-bottom:1px solid #e6e6e6}.pabcde8-83d{margin-bottom:10px;margin-right:28px}.pabcde8-b1c{visibility:visible}");var s=e("./index"),n="111111111111111111111111",p="000000000000000000000000",r=function(e){for(var a=0;a<7;)e[a]=s.improve(e[a]),a++;return e};d.exports=i.View.extend({tmpl:{html:'<div class="pabcde8-f9d"><div mx-guid="g7" class="pabcde8-e16" id="dlg_<%=$$.viewId%>"><div mx-guid="g6" class="pabcde8-551">2</div><div><button type="button" class="pabcdf0-btn pabcdf0-046" mx-click="apply()">确认</button><button type="button" mx-click="closeDlg()" class="pabcdf0-btn pabcd16-ml5">取消</button></div></div><div class="pabcde8-b45"><label class="pabcde8-e60"><input mx-guid="gb" class="pabcd16-mr5" type="radio" mx-click="st({type:0})" name="st-<%=$$.viewId%>" <%if($$.allDays){%> checked<%}%>/> 全日程投放</label><label class="pabcde8-e60"><input mx-guid="gc" class="pabcd16-mr5" type="radio" mx-click="st({type:1})" name="st-<%=$$.viewId%>" <%if($$.weekdays){%> checked<%}%>/> 工作日（周一至周五）投放</label><label><input mx-guid="gd" class="pabcd16-mr5" type="radio" mx-click="st({type:2})" name="st-<%=$$.viewId%>" <%if($$.weekends){%> checked<%}%>/> 休息日（周六、周日）投放</label></div><table class="pabcde8-05c"><thead><tr class="pabcde8-e0c"><td width="160" class="pabcde8-4ae">时间段</td><td class="pabcde8-ec7"><span class="pabcde8-f6f pabcde8-84e">0:00</span><span class="pabcde8-f6f pabcde8-33d">6:00</span><span class="pabcde8-f6f pabcde8-025">12:00</span><span class="pabcde8-f6f pabcde8-d3c">18:00</span><span class="pabcde8-f6f pabcde8-b9c">24:00</span></td><td width="160" align="center">操作</td></tr></thead><tbody mx-guid="ge">3</tbody></table></div>',subs:[{s:"2",keys:["currentClone"],tmpl:'<%for(var i = 0; i < $$.days.length; i++){%><label class="pabcde8-83d<%if(i==$$.currentClone){%> pabcd2c-864<%}%>"><input class="pabcd16-fdc" type="checkbox" value="<%=i%>" <%if(i==$$.currentClone){%> disabled<%}%>/>周<%=$$.days.charAt(i)%></label><%}%>',path:'div[mx-guid="g6"]'},{keys:["viewId"],path:'div[mx-guid="g7"]',attr:'id="dlg_<%=$$.viewId%>"',attrs:[{n:"id",p:1}]},{s:"3",keys:["viewId"],tmpl:'<%for(var i = 0; i < $$.days.length; i++){%><tr class="pabcde8-day"><td class="pabcde8-458" mx-click="toggle({day:<%=i%>})">周<%=$$.days.charAt(i)%></td><td id="hours_<%=$$.viewId%>_<%=i%>" mx-view="app/gallery/mx-hourpicker/index" mx-change="hour({day:<%=i%>})"></td><td align="center"><div class="pabcde8-fb7"><a mx-click="copy({day:<%=i%>})" href="javascript:;">复制到</a></div></td></tr><%}%>',path:'tbody[mx-guid="ge"]'},{keys:["viewId","allDays"],path:'input[mx-guid="gb"]',attr:'name="st-<%=$$.viewId%>" <%if($$.allDays){%> checked<%}%>',attrs:[{n:"name"},{n:"checked",b:1,p:1}]},{keys:["viewId","weekdays"],path:'input[mx-guid="gc"]',attr:'name="st-<%=$$.viewId%>" <%if($$.weekdays){%> checked<%}%>',attrs:[{n:"name"},{n:"checked",b:1,p:1}]},{keys:["viewId","weekends"],path:'input[mx-guid="gd"]',attr:'name="st-<%=$$.viewId%>" <%if($$.weekends){%> checked<%}%>',attrs:[{n:"name"},{n:"checked",b:1,p:1}]}]},init:function(e){var a=this;a.$days=e.days||[p,p,p,p,p,p,p],a.$days=r(a.$days),c.setup(),a.on("destroy",c.teardown)},render:function(){var e=this;e.updater.digest({viewId:e.id,days:"一二三四五六日"}),e.val(e.$days)},inside:function(e){var a=this,d=i.inside(e,"dlg_"+a.id);if(!d&&a.$ref){var t=a.$ref.parent();d=i.inside(e,t[0])}return d},syncShortcuts:function(){var e=this,a=e.$days.slice(0,5).join(""),d=e.$days.slice(-2).join(""),i=a.indexOf("1")>-1,t=d.indexOf("1")>-1,c=-1==a.indexOf("0"),s=-1==d.indexOf("0"),n=c&&s;e.updater.digest({allDays:n,weekdays:!t&&c,weekends:s&&!i})},syncUI:function(){for(var e=this,a=e.$days,d=0,t=void 0,c=void 0;d<a.length;d++)t=a[d],(c=i.Vframe.get("hours_"+e.id+"_"+d))&&c.invoke("val",[t])},val:function(e){var a=this;return e&&(a.$days=r(e),a.syncUI(),a.syncShortcuts()),a.$days},show:function(){var e=this;if(!e.$shown){e.$shown=!0,c.add(e);var a=e.$ref,d=t("#dlg_"+e.id);d.show();var i=a.offset(),s=i.left+a.outerWidth()-d.outerWidth(),n=i.top+a.outerHeight()+10;d.offset({left:s,top:n}),a.parent().addClass("pabcde8-b1c")}},hide:function(){var e=this;if(e.$shown){e.$shown=!1,c.remove(e),t("#dlg_"+e.id).hide();var a=e.$ref;a&&a.parent().removeClass("pabcde8-b1c")}},"st<click>":function(e){var a=this;switch(e.params.type){case 0:a.$days=[n,n,n,n,n,n,n];break;case 1:a.$days=[n,n,n,n,n,p,p];break;case 2:a.$days=[p,p,p,p,p,n,n]}a.syncShortcuts(),a.syncUI()},"hour<change>":function(e){var a=this;a.$days[e.params.day]=e.range,clearTimeout(a.$timer),a.$timer=setTimeout(a.wrapAsync(function(){a.syncShortcuts()}),100)},"toggle<click>":function(e){var a=e.params.day,d=this,t=i.Vframe.get("hours_"+d.id+"_"+a);if(t){t.invoke("val").indexOf("0")>-1?t.invoke("val",[d.$days[a]=n]):t.invoke("val",[d.$days[a]=p]),d.syncShortcuts()}},"copy<click>":function(e){var a=this,d=t(e.eventTarget);a.$ref=d,a.show(),a.updater.digest({currentClone:e.params.day})},"closeDlg<click>":function(){this.hide()},"apply<click>":function(){var e=this,a=e.updater.get("currentClone"),d=e.$days[a];t("#dlg_"+e.id+" input:checked").each(function(a,i){e.$days[i.value]=d}),e.hide(),e.syncUI(),e.syncShortcuts()}})});