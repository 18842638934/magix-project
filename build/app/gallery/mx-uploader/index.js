define("app/gallery/mx-uploader/index",["magix","$"],function(t,e,i){var r=t("magix"),n=t("$");r.applyStyle("pdc",".pdc-pr{position:relative;overflow:hidden}.pdc-bf0{left:0;top:0;bottom:0;right:0;width:100%;height:100%;opacity:0;cursor:pointer;font-size:100px;filter:alpha(opacity=0)}.pdc-cnt,.pdc-bf0{position:absolute}.pdc-cnt{left:-999999px}");var a=r.Base.extend({destroy:function(){this.$oust=1}}),p=a.extend({send:function(t,e,i){var a=t.form,p=this,o=r.guid("up");if(!a){n("body").append('<div id="'+o+'_temp" class="pdc-cnt"><form target="'+o+'"></form></div>');a=n("#"+o+"_temp").find("form"),a.append(t),a=a[0]}n('<iframe name="'+o+'" id="'+o+'" style="display:none;"></iframe>').insertAfter(a).on("load",function(){if(!p.$oust){var t=event.target,e=n(t.contentWindow.document.body);e.find("script").remove();var r=n.trim(e.text());n(t).remove(),n("#"+o+"_temp").remove();try{i(null,new Function("return "+r)())}catch(t){i(t)}}}).on("error",function(t){p.$oust||(n("#"+o+"_temp").remove(),i(t))}),a.target=o,a.action=e.get("action"),a.method="POST",a.enctype="multipart/form-data",a.submit()}});i.exports=r.View.extend({init:function(t){var e=this;e.updater.set({name:t.name||"file",action:t.action||"",multiple:t.multiple,accept:t.accept}),e.capture("transport",new p)},add:function(){var t=this,e="file_"+t.id,i=n("#"+e);i.length&&i.remove();var r=t.updater.get();n("#"+t.id).append(t.wrapEvent('<input id="'+e+'" type="file" class="pdc-bf0" mx-change="upload()" name="'+r.name+'" />')).addClass("pdc-pr"),i=n("#"+e),r.multiple&&i.attr("multiple","multiple"),r.accept&&i.prop("accept",r.accept)},render:function(){this.add()},"upload<change>":function(t){var e=this,i=n("#"+e.id),r=n.Event("start",{files:t.eventTarget.files});if(i.trigger(r),r.isDefaultPrevented())return void e.add();e.capture("transport").send(t.target,e.updater,function(t,e){t?i.trigger({type:"error",error:t}):i.trigger({type:"success",response:e})}),e.add()}})});