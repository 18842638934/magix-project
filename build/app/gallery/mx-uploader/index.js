define("app/gallery/mx-uploader/index",["magix","$"],function(t,e,a){var i=t("magix"),r=t("$");i.applyStyle("pabcddc",".pabcddc-pr{position:relative;overflow:hidden}.pabcddc-bf0{left:0;top:0;bottom:0;right:0;width:100%;height:100%;opacity:0;cursor:pointer;font-size:100px;filter:alpha(opacity=0)}.pabcddc-cnt,.pabcddc-bf0{position:absolute}.pabcddc-cnt{left:-999999px}");var n=i.Base.extend({destroy:function(){this.$oust=1}}),d=n.extend({send:function(t,e,a){var n=t.form,d=this,p=i.guid("up");if(!n){r("body").append('<div id="'+p+'_temp" class="pabcddc-cnt"><form target="'+p+'"></form></div>');n=r("#"+p+"_temp").find("form"),n.append(t),n=n[0]}r('<iframe name="'+p+'" id="'+p+'" style="display:none;"></iframe>').insertAfter(n).on("load",function(){if(!d.$oust){var t=event.target,e=r(t.contentWindow.document.body);e.find("script").remove();var i=r.trim(e.text());r(t).remove(),r("#"+p+"_temp").remove();try{a(null,new Function("return "+i)())}catch(t){a(t)}}}).on("error",function(t){d.$oust||(r("#"+p+"_temp").remove(),a(t))}),n.target=p,n.action=e.get("action"),n.method="POST",n.enctype="multipart/form-data",n.submit()}});a.exports=i.View.extend({init:function(t){var e=this;e.updater.set({name:t.name||"file",action:t.action||"",multiple:t.multiple,accept:t.accept}),e.capture("transport",new d)},add:function(){var t=this,e="file_"+t.id,a=r("#"+e);a.length&&a.remove();var i=t.updater.get();r("#"+t.id).append(t.wrapEvent('<input id="'+e+'" type="file" class="pabcddc-bf0" mx-change="upload()" name="'+i.name+'" />')).addClass("pabcddc-pr"),a=r("#"+e),i.multiple&&a.attr("multiple","multiple"),i.accept&&a.prop("accept",i.accept)},render:function(){this.add()},"upload<change>":function(t){var e=this,a=r("#"+e.id),i=r.Event("start",{files:t.eventTarget.files});if(a.trigger(i),i.isDefaultPrevented())return void e.add();e.capture("transport").send(t.target,e.updater,function(t,e){t?a.trigger({type:"error",error:t}):a.trigger({type:"success",response:e})}),e.add()}})});