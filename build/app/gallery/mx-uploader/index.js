define("app/gallery/mx-uploader/index",["magix","$"],function(e,t,n){var r=e("magix"),a=e("$");r.applyStyle("pdc",".pdc-pr{position:relative;overflow:hidden}.pdc-bf0{left:0;top:0;bottom:0;right:0;width:100%;height:100%;opacity:0;cursor:pointer;font-size:100px;filter:alpha(opacity=0)}.pdc-cnt,.pdc-bf0{position:absolute}.pdc-cnt{left:-999999px}");var i=r.Base.extend({destroy:function(){this.$oust=1}}),o=i.extend({send:function(e,t,n,i){var o=e.form,p=this,d=r.guid("up");if(!o){a("body").append('<div id="'+d+'_temp" class="pdc-cnt"><form target="'+d+'"></form></div>');o=a("#"+d+"_temp").find("form"),o.append(e),o=o[0]}var c=0,s=2e3;if(e.files){s=0;for(var l=0;l<e.files.length;l++)s+=e.files[l].size;s/=1e3,s<2e3&&(s=2e3)}var u=1e3/s,f=setInterval(function(){c<1&&(i(c),c+=u+20*Math.random()*u)},50);a('<iframe name="'+d+'" id="'+d+'" style="display:none;"></iframe>').insertAfter(o).on("load",function(e){if(clearInterval(f),!p.$oust){i(1);var t=e.target,r=a(t.contentWindow.document.body);r.find("script").remove();var o=a.trim(r.text());a(t).remove(),a("#"+d+"_temp").remove();try{n(null,new Function("return "+o)())}catch(e){n(e)}}}).on("error",function(e){clearInterval(f),p.$oust||(a("#"+d+"_temp").remove(),n(e))}),o.target=d,o.action=t.get("action"),o.method="POST",o.enctype="multipart/form-data",o.submit()}}),p=i.extend({send:function(e,t,n,r){for(var a=new FormData,i=this,o=e.files,p=0;p<o.length;p++)a.append(t.get("name"),o[p]);var d=new XMLHttpRequest;d.open("post",t.get("action"),!0),d.onload=function(){if(!i.$oust)try{n(null,new Function("return "+d.responseText)())}catch(e){n(e)}},d.onerror=function(e){i.$oust||(e.message="network error",n(e))},d.upload.onprogress=function(e){r(e.lengthComputable?e.loaded/e.total:0)},d.send(a)}});n.exports=r.View.extend({init:function(e){var t=this;t.updater.set({name:e.name||"file",action:e.action||"",multiple:e.multiple,accept:e.accept});var n;n=window.FormData?p:o,t.capture("transport",new n)},add:function(){var e=this,t="file_"+e.id,n=a("#"+t);n.length&&n.remove();var r=e.updater.get();a("#"+e.id).append(e.wrapEvent('<input id="'+t+'" type="file" class="pdc-bf0" mx-change="upload()" name="'+r.name+'" />')).addClass("pdc-pr"),n=a("#"+t),r.multiple&&n.attr("multiple","multiple"),r.accept&&n.prop("accept",r.accept)},render:function(){this.add()},"upload<change>":function(e){var t=this,n=a("#"+t.id),r=a.Event("start",{files:e.eventTarget.files});if(n.trigger(r),r.isDefaultPrevented())return void t.add();t.capture("transport").send(e.target,t.updater,function(e,t){e?n.trigger({type:"error",error:e}):n.trigger({type:"success",response:t})},function(e){n.trigger({type:"progress",percent:e})}),t.add()}})});