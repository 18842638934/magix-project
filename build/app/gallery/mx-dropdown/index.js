define("app/gallery/mx-dropdown/index",["magix","$","../mx-monitor/index"],function(e,t,i){var s=e("magix"),p=e("$"),a=e("../mx-monitor/index");s.applyStyle("p21",".p21-d9b{position:relative;display:inline-block;width:340px;background-color:#fff;text-align:left;font-size:14px;border:1px solid #e6e6e6;border-radius:4px}.p21-d3b{color:#333;position:relative;width:100%;cursor:pointer;user-select:none;padding:0 30px 0 12px;border-radius:3px}.p21-d86{cursor:not-allowed;background-color:#e6e6e6;color:#ccc}.p21-c47,.p21-up{position:absolute;right:0;top:4px;font-size:28px;color:#ccc}.p21-fbd .p21-c47{display:inline}.p21-c47,.p21-fbd .p21-up{display:none}.p21-fbd .p21-d3b{background-color:#eaeaea}.p21-fbd .p21-d3b:hover{background-color:#d4d4d4}.p21-17b{height:32px;line-height:32px;display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.p21-ecb{position:absolute;top:100%;left:-1px;right:-1px;margin-top:5px;border-radius:4px;z-index:300;border:1px solid #e6e6e6;background-color:#fff;display:none;user-select:none}.p21-fbd .p21-ecb{display:block}.p21-f2a{overflow:auto;max-height:192px;padding-bottom:3px;padding-top:5px}.p21-c14{display:block;width:100%;padding:9px 9px 4px}.p21-e01{padding:0;width:100%}.p21-427{color:#ccc;position:absolute;left:15px;top:18px}.p21-749{padding-left:28px;width:100%}.p21-f83{padding-left:5px;padding-right:15px;color:#999;display:block;cursor:default}.p21-432{padding:3px 10px}.p21-f0e{color:#666;display:block;width:100%;padding:0 6px;height:26px;line-height:26px;border-radius:4px}.p21-f0e:active,.p21-f0e:focus,.p21-f0e:hover{color:#333;background-color:#f0f0f0}.p21-dfe,.p21-dfe:active,.p21-dfe:focus,.p21-dfe:hover{color:#fff;background-color:#6363e6}"),i.exports=s.View.extend({tmpl:{html:'<div mx-guid="g1" id="toggle_<%=$$.viewId%>" class="p21-d3b <%=$$.disabled?\'p21-d86\':\'\'%>" mx-click="toggle()" title="<%=$$.selectedText%>"><span mx-guid="g0" class="p21-17b">2</span><span class="pce-334 p21-up">&#xe786;</span><span class="pce-334 p21-c47">&#xe692;</span></div><div mx-guid="g3" class="p21-ecb">3</div>',subs:[{s:"2",keys:["selectedText"],tmpl:"<%=$$.selectedText%>",path:'span[mx-guid="g0"]'},{keys:["viewId","disabled","selectedText"],path:'div[mx-guid="g1"]',attr:'id="toggle_<%=$$.viewId%>" class="p21-d3b <%=$$.disabled?\'p21-d86\':\'\'%>" mx-click="toggle()" title="<%=$$.selectedText%>"',attrs:[{n:"id",p:1},{n:"class",p:1,f:"className"},{n:"mx-click"},{n:"title",p:1}]},{s:"3",keys:["rList","searchbox"],tmpl:'<%if($$.rList){if($$.searchbox){%><div class="p21-c14"><label class="p21-e01"><span class="pce-334 p21-427">&#xe608;</span><input mx-keyup="search()" mx-paste="search()" type="text" placeholder="搜索关键词" mx-change="stop()" class="p5c-dc6 p21-749"/></label></div><%}%><ul mx-guid="g2" class="p21-f2a" id="list_<%=$$.viewId%>">4</ul><%}%>',path:'div[mx-guid="g3"]'},{s:"4",keys:["viewId","list","textKey","valueKey","selected"],tmpl:'<%for(var a=0,b,c,d;b=$$.list[a];a++){if($$.textKey&&$$.valueKey){c=b[$$.textKey];d=b[$$.valueKey];}else{c=b;d=b;}if(b&&b.group){%><li class="p21-f83 p16-9e0" title="<%=b[$$.textKey]%>"><%=b[$$.textKey]%></li><%}else{%><li title="<%=c%>" class="p21-432"><%var e=(d+\'\')===($$.selected+\'\')%><a href="javascript:;" class="p21-f0e p16-9e0 <%=e?\'p21-dfe\':\'\'%>" mx-click="select({path:\'list.<%=a%>\'})"><%=c%></a></li><%}}%>',path:'ul[mx-guid="g2"]',pKeys:["rList","searchbox"],attr:'id="list_<%=$$.viewId%>"',attrs:[{n:"id",p:1}],mask:"21111"}]},init:function(e){var t=this;a.setup(),t.on("destroy",a.teardown),e.viewId=t.id,t.updater.set(e)},inside:function(e){var t=this;return s.inside(e,t.id)},render:function(){var e=this,t=p("#"+e.id);e.$oNode=t;var i=e.updater,a=i.get();if(t.addClass("p21-d9b"),!a.list){var d,o=[];t.children().each(function(e,t){t=p(t),d="true"==t.attr("group"),o.push({group:d,text:t.text(),value:d?s.guid():t.attr("value")})}),e.updater.set({textKey:"text",valueKey:"value",list:o})}e.updateList(a.list,a.selected,!0)},hide:function(){var e=this;e.$oNode.hasClass("p21-fbd")&&(e.$oNode.removeClass("p21-fbd").trigger("focusout"),a.remove(e))},show:function(){var e=this;if(!e.$oNode.hasClass("p21-fbd")){e.updater.get().rList||e.updater.digest({rList:!0}),e.$oNode.addClass("p21-fbd").trigger("focusin");var t=p("#list_"+e.id),i=t.find(".p21-dfe"),s=i.position(),d=t.height(),o=t.prop("scrollTop");if(s.top<0||s.top>d){var l=s.top-d+o+d/2;t.prop("scrollTop",l)}a.add(e)}},updateList:function(e,t,i){var p=this;t+="";var a=p.updater,d=a.get();e=(e||[]).slice();var o=d.textKey||"",l=d.valueKey||"";if(d.emptyText)if(o&&l){var r={};r[o]=d.emptyText,r[l]="",e.unshift(r)}else e.unshift(d.emptyText);var c=s.toMap(e,l);p.$list=e,p.$map=c,t||!d.emptyText||o||l||(t=d.emptyText),t&&c[t]||(t=c[t]||e[0],o&&l&&(t=t[l])),a.digest({selected:t,selectedText:o&&l?c[t][o]:t,list:e}),p.$oNode.val(t),i||p.fireEvent(t)},search:function(e,t){var i=this;clearTimeout(i.$goTimer);var s=i.$list,p=i.updater.get(),a=[],d=0,o=s.length,l=p.textKey,r=p.valueKey;if(!e)return void t(s);var c=function(){if(d<o){for(var p=Math.min(d+400,o),n=d,u=void 0,f=void 0,x=void 0;n<p;n++)u=s[n],f=u,x=u,l&&r&&(f=u[l],x=u[r]),((f+"").indexOf(e)>=0||(x+"").indexOf(e)>=0)&&a.push(u);d=p,i.$goTimer=setTimeout(i.wrapAsync(c),20)}else t(a)};c()},fireEvent:function(e,t){var i=this,s=i.updater,a=s.get(),d=a.valueKey,o=a.textKey,l=s.gain(e),r=a.selected,c=l,n=l;if(o&&d&&(n=l[o],c=l[d]),!t||r!=c){s.set({selected:c});var u=p.Event("change",{item:l,keys:{text:o,value:d},value:d?l[d]:l,text:o?l[o]:l});i.$oNode.val(d?l[d]:l).trigger(u),u.isDefaultPrevented()?s.set({selected:r}):s.digest({selected:c,selectedText:n})}},getSelected:function(){return this.updater.get("selected")},getList:function(){return this.updater.get("list")},val:function(){return p("#"+this.id).val()},"toggle<click>":function(){var e=this,t=p("#toggle_"+e.id);e.$oNode.hasClass("p21-fbd")?e.hide():t.hasClass("p21-d86")||e.show()},"search<keyup,paste>":function(e){var t=this;clearTimeout(t.$sTimer),t.$sTimer=setTimeout(t.wrapAsync(function(){var i=p.trim(e.eventTarget.value);i!=t.$lVal&&t.search(t.$lVal=i,function(e){t.updater.digest({list:e})})}),300)},"select<click>":function(e){var t=this;t.fireEvent(e.params.path,!0),t.hide()},"stop<change>":function(e){e.stopPropagation()}})});