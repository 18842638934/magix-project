define("app/gallery/mx-colorpicker/index",["magix","$","../mx-dragdrop/index"],function(t,i,e){var d=t("magix"),o=t("$"),s=t("../mx-dragdrop/index");d.applyStyle("pabcd52",'.pabcd52-cnt{padding:10px;background-color:#fff;display:inline-block;border:1px solid #ccc;border-radius:5px;overflow-y:hidden;z-index:10}.pabcd52-b45 ul{width:225px;zoom:1}.pabcd52-b45 ul:after,.pabcd52-b45 ul:before{display:table;content:""}.pabcd52-b45 ul:after{clear:both}.pabcd52-b45 li{border:1px solid #000;float:left;width:15px;height:15px;margin:-1px 0 0 -1px;display:inline;position:relative}.pabcd52-b45 li.pabcd52-2ed:before{content:"√";display:inherit;position:absolute;left:2px;top:-12px}.pabcd52-551{margin:10px 0;height:200px}.pabcd52-049{position:relative;float:left}.pabcd52-65b{width:196px;height:196px}.pabcd52-af0{position:absolute;width:10px;height:10px;border-radius:5px;border:3px solid #888;cursor:default}.pabcd52-070{position:relative;float:left;margin-left:10px}.pabcd52-7c8{width:20px;height:196px}.pabcd52-67d{position:absolute;left:4px;top:-8px;border:8px solid transparent;border-right-color:#888;width:0;height:0;cursor:default}.pabcd52-b18{height:25px}.pabcd52-b18 input{width:99px;margin-right:5px}.pabcd52-0a0,.pabcd52-b18 input{vertical-align:middle}.pabcd52-0a0{width:50px;height:23px;line-height:23px;display:inline-block;margin-right:10px;border:1px solid #ddd}');var a=window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",c=function(t,i){i.append('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="100%"><defs><linearGradient id="gradient-hsv" x1="0%" y1="100%" x2="0%" y2="0%"><stop offset="0%" stop-color="#FF0000" stop-opacity="1"></stop><stop offset="13%" stop-color="#FF00FF" stop-opacity="1"></stop><stop offset="25%" stop-color="#8000FF" stop-opacity="1"></stop><stop offset="38%" stop-color="#0040FF" stop-opacity="1"></stop><stop offset="50%" stop-color="#00FFFF" stop-opacity="1"></stop><stop offset="63%" stop-color="#00FF40" stop-opacity="1"></stop><stop offset="75%" stop-color="#0BED00" stop-opacity="1"></stop><stop offset="88%" stop-color="#FFFF00" stop-opacity="1"></stop><stop offset="100%" stop-color="#FF0000" stop-opacity="1"></stop></linearGradient></defs><rect x="0" y="0" width="100%" height="100%" fill="url(#gradient-hsv)"></rect></svg>'),t.append('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="100%"><defs><lineargradient id="gradient-black" x1="0%" y1="100%" x2="0%" y2="0%"><stop offset="0%" stop-color="#000000" stop-opacity="1"></stop><stop offset="100%" stop-color="#CC9A81" stop-opacity="0"></stop></lineargradient><lineargradient id="gradient-white" x1="0%" y1="100%" x2="100%" y2="100%"><stop offset="0%" stop-color="#FFFFFF" stop-opacity="1"></stop><stop offset="100%" stop-color="#CC9A81" stop-opacity="0"></stop></lineargradient></defs><rect x="0" y="0" width="100%" height="100%" fill="url(#gradient-white)"></rect><rect x="0" y="0" width="100%" height="100%" fill="url(#gradient-black)"></rect></svg>')},p=function(t,i){document.namespaces.mxv||document.namespaces.add("mxv","urn:schemas-microsoft-com:vml","#default#VML"),i.html('<div style="position: relative; width: 100%; height: 100%"><mxv:rect style="position: absolute; top: 0; left: 0; width: 100%; height: 100%" stroked="f" filled="t"><mxv:fill type="gradient" method="none" angle="0" color="red" color2="red" colors="8519f fuchsia;.25 #8000ff;24903f #0040ff;.5 aqua;41287f #00ff40;.75 #0bed00;57671f yellow"></mxv:fill></mxv:rect></div>'),t.html('<div style="position: relative; width: 100%; height: 100%"><mxv:rect style="position: absolute; left: -1px; top: -1px; width: 101%; height: 101%" stroked="f" filled="t"><mxv:fill type="gradient" method="none" angle="270" color="#FFFFFF" opacity="100%" color2="#CC9A81" o:opacity2="0%"></mxv:fill></mxv:rect><mxv:rect style="position: absolute; left: 0px; top: 0px; width: 100%; height: 101%" stroked="f" filled="t"><mxv:fill type="gradient" method="none" angle="0" color="#000000" opacity="100%" color2="#CC9A81" o:opacity2="0%"></mxv:fill></mxv:rect></div>')},r={selected:"pabcd52-2ed",cnt:"pabcd52-cnt"},l=["d81e06","f4ea2a","1afa29","1296db","13227a","d4237a","ffffff","e6e6e6","dbdbdb","cdcdcd","bfbfbf","8a8a8a","707070","515151","2c2c2c","000000","ea986c","eeb174","f3ca7e","f9f28b","c8db8c","aad08f","87c38f","83c6c2","7dc5eb","87a7d6","8992c8","a686ba","bd8cbb","be8dbd","e89abe","e8989a","e16632","e98f36","efb336","f6ef37","afcd51","7cba59","36ab60","1baba8","17ace3","3f81c1","4f68b0","594d9c","82529d","a4579d","db649b","dd6572","d81e06","e0620d","ea9518","f4ea2a","8cbb1a","2ba515","0e932e","0c9890","1295db","0061b2","0061b0","004198","122179","88147f","d3227b","d6204b"],n=function(t,i,e){var d,o,s,a,c;t=t%360/60,c=e*i,a=c*(1-Math.abs(t%2-1)),d=o=s=e-c,t=~~t,d+=[c,a,0,0,a,c][t],o+=[a,c,c,a,0,0][t],s+=[0,0,a,c,c,a][t];var p=255*d,r=255*o,l=255*s;return{r:p,g:r,b:l,hex:"#"+(16777216|l|r<<8|p<<16).toString(16).slice(1)}},f=function(t,i,e){t/=255,i/=255,e/=255;var d,o,s,a;return s=Math.max(t,i,e),a=s-Math.min(t,i,e),d=0===a?null:s==t?(i-e)/a+(i<e?6:0):s==i?(e-t)/a+2:(t-i)/a+4,d=d%6*60,o=0===a?0:a/s,{h:d,s:o,v:s}};e.exports=d.View.extend({tmpl:{html:'<div mx-guid="g2" class="pabcd52-b45" id="shortcuts_<%=$$.id%>"><ul mx-guid="g1">2</ul></div><div class="pabcd52-551"><div class="pabcd52-049"><div mx-guid="g3" class="pabcd52-65b" id="cpicker_<%=$$.id%>" mx-click="colorZoneClick()"></div><div mx-guid="g4" class="pabcd52-af0" id="ph_<%=$$.id%>" mx-mousedown="dragPicker()"></div></div><div class="pabcd52-070"><div mx-guid="g5" class="pabcd52-7c8" id="slide_<%=$$.id%>" mx-click="slideClick()"></div><div mx-guid="g6" class="pabcd52-67d" mx-mousedown="dragSlide();" id="sh_<%=$$.id%>"></div></div></div><div class="pabcd52-b18"><span mx-guid="g8" class="pabcd52-0a0" id="bgcolor_<%=$$.id%>"></span><input mx-guid="g7" class="pabcd5c-dc6" readonly="readonly" id="val_<%=$$.id%>"/><button class="pabcdf0-btn pabcdf0-046" type="button" mx-click="enter();">确定</button></div>',subs:[{s:"2",keys:["shortcuts","id"],tmpl:'<%for(var i=0;i<$$.shortcuts.length;i++){%><li id="sc_<%=$$.shortcuts[i]%>_<%=$$.id%>" style="background:#<%=$$.shortcuts[i]%>" mx-click="pickShortcuts({color:\'#<%=$$.shortcuts[i]%>\'})"></li><%}%>',path:'ul[mx-guid="g1"]'},{keys:["id"],path:'div[mx-guid="g2"]',attr:'id="shortcuts_<%=$$.id%>"',attrs:[{n:"id",p:1}]},{keys:["id"],path:'div[mx-guid="g3"]',attr:'id="cpicker_<%=$$.id%>"',attrs:[{n:"id",p:1}]},{keys:["id"],path:'div[mx-guid="g4"]',attr:'id="ph_<%=$$.id%>"',attrs:[{n:"id",p:1}]},{keys:["id"],path:'div[mx-guid="g5"]',attr:'id="slide_<%=$$.id%>"',attrs:[{n:"id",p:1}]},{keys:["id"],path:'div[mx-guid="g6"]',attr:'id="sh_<%=$$.id%>"',attrs:[{n:"id",p:1}]},{keys:["id"],path:'span[mx-guid="g8"]',attr:'id="bgcolor_<%=$$.id%>"',attrs:[{n:"id",p:1}]},{keys:["id"],path:'input[mx-guid="g7"]',attr:'id="val_<%=$$.id%>"',attrs:[{n:"id",p:1}]}]},init:function(t){var i=this;i.$color=t.color||"#ffffff",i.$hsv={h:0,s:1,v:1},o("#"+i.id).addClass(r.cnt)},render:function(){var t=this;t.updater.digest({id:t.id,shortcuts:l});var i=o("#slide_"+t.id),e=o("#cpicker_"+t.id);"SVG"==a?c(e,i):p(e,i),t.setColor(t.$color)},setHSV:function(t,i){var e=this,d=e.$hsv;d.h=t.h%360,d.s=t.s,d.v=t.v;var s=n(t.h,t.s,t.v),a=s.hex,c=o("#cpicker_"+e.id),p=n(t.h,1,1);if(c.css("background",p.hex),o("#bgcolor_"+e.id).css("background",a),o("#val_"+e.id).val(a),!i){o("#shortcuts_"+e.id+" li").removeClass(r.selected);var l=Math.round(196*d.h/360-8);o("#sh_"+e.id).css({top:l}),l=Math.round(196*(1-d.v)-6);var f=Math.round(196*d.s-6);o("#ph_"+e.id).css({left:f,top:l})}o("#sc_"+a.substr(1,6)+"_"+e.id).addClass(r.selected)},setColor:function(t){var i=this,e=parseInt(t.substr(1,2),16),d=parseInt(t.substr(3,2),16),o=parseInt(t.substr(5,2),16),s=f(e,d,o);i.setHSV(s)},"dragSlide<mousedown>":function(t){var i=this,e=o(t.eventTarget),d=parseInt(e.css("top"),10),a=t;s.begin(t.eventTarget,function(t){var o=t.pageY-a.pageY;o+=d,o<=-8?o=-8:o>=188&&(o=188),e.css({top:o});var s=(o+8)/196*360;i.setHSV({h:s,s:i.$hsv.s,v:i.$hsv.v},!0)})},"dragPicker<mousedown>":function(t){var i=this,e=o(t.eventTarget),d=parseInt(e.css("left"),10),a=parseInt(e.css("top"),10),c=t;s.begin(t.eventTarget,function(t){var o=t.pageY-c.pageY,s=t.pageX-c.pageX;o+=a,o<=-6?o=-6:o>=190&&(o=190),s+=d,s<=-6?s=-6:s>=190&&(s=190),e.css({top:o,left:s});var p=(s+6)/196,r=(196-(o+6))/196;i.setHSV({h:i.$hsv.h,s:p,v:r})})},"slideClick<click>":function(t){var i=this,e=o(t.eventTarget).offset(),d=t.pageY-e.top,s=d/196*360;i.setHSV({h:s,s:i.$hsv.s,v:i.$hsv.v})},"colorZoneClick<click>":function(t){var i=this,e=o(t.eventTarget).offset(),d=t.pageX-e.left,s=t.pageY-e.top,a=d/196,c=(196-s)/196;i.setHSV({h:i.$hsv.h,s:a,v:c})},"pickShortcuts<click>":function(t){this.setColor(t.params.color),o(t.eventTarget).addClass(r.selected)},"enter<click>":function(){var t=this,i=o("#val_"+t.id);o("#"+t.id).trigger({type:"pick",color:i.val()})}})});