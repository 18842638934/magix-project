define("app/gallery/mx-colorpicker/index",["magix","$","../mx-dragdrop/index"],function(t,i,e){var o=t("magix"),s=t("$"),d=t("../mx-dragdrop/index");o.applyStyle("p52",'.p52-cnt{padding:10px;background-color:#fff;display:inline-block;border:1px solid #ccc;border-radius:5px;overflow-y:hidden;z-index:10}.p52-b45 ul{width:225px;zoom:1}.p52-b45 ul:after,.p52-b45 ul:before{display:table;content:""}.p52-b45 ul:after{clear:both}.p52-b45 li{border:1px solid #000;float:left;width:15px;height:15px;margin:-1px 0 0 -1px;display:inline;position:relative}.p52-b45 li.p52-2ed:before{content:"√";display:inherit;position:absolute;left:2px;top:-12px}.p52-551{margin:10px 0;height:200px}.p52-049{position:relative;float:left}.p52-65b{width:196px;height:196px}.p52-af0{position:absolute;width:10px;height:10px;border-radius:5px;border:3px solid #888;cursor:default}.p52-070{position:relative;float:left;margin-left:10px}.p52-7c8{width:20px;height:196px}.p52-67d{position:absolute;left:4px;top:-8px;border:8px solid transparent;border-right-color:#888;width:0;height:0;cursor:default}.p52-b18{height:25px}.p52-b18 input{width:99px;margin-right:5px}.p52-0a0,.p52-b18 input{vertical-align:middle}.p52-0a0{width:50px;height:23px;line-height:23px;display:inline-block;margin-right:10px;border:1px solid #ddd}');var a=window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",p=function(t,i){i.append('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="100%"><defs><linearGradient id="gradient-hsv" x1="0%" y1="100%" x2="0%" y2="0%"><stop offset="0%" stop-color="#FF0000" stop-opacity="1"></stop><stop offset="13%" stop-color="#FF00FF" stop-opacity="1"></stop><stop offset="25%" stop-color="#8000FF" stop-opacity="1"></stop><stop offset="38%" stop-color="#0040FF" stop-opacity="1"></stop><stop offset="50%" stop-color="#00FFFF" stop-opacity="1"></stop><stop offset="63%" stop-color="#00FF40" stop-opacity="1"></stop><stop offset="75%" stop-color="#0BED00" stop-opacity="1"></stop><stop offset="88%" stop-color="#FFFF00" stop-opacity="1"></stop><stop offset="100%" stop-color="#FF0000" stop-opacity="1"></stop></linearGradient></defs><rect x="0" y="0" width="100%" height="100%" fill="url(#gradient-hsv)"></rect></svg>'),t.append('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="100%"><defs><lineargradient id="gradient-black" x1="0%" y1="100%" x2="0%" y2="0%"><stop offset="0%" stop-color="#000000" stop-opacity="1"></stop><stop offset="100%" stop-color="#CC9A81" stop-opacity="0"></stop></lineargradient><lineargradient id="gradient-white" x1="0%" y1="100%" x2="100%" y2="100%"><stop offset="0%" stop-color="#FFFFFF" stop-opacity="1"></stop><stop offset="100%" stop-color="#CC9A81" stop-opacity="0"></stop></lineargradient></defs><rect x="0" y="0" width="100%" height="100%" fill="url(#gradient-white)"></rect><rect x="0" y="0" width="100%" height="100%" fill="url(#gradient-black)"></rect></svg>')},r=function(t,i){document.namespaces.mxv||document.namespaces.add("mxv","urn:schemas-microsoft-com:vml","#default#VML"),i.html('<div style="position: relative; width: 100%; height: 100%"><mxv:rect style="position: absolute; top: 0; left: 0; width: 100%; height: 100%" stroked="f" filled="t"><mxv:fill type="gradient" method="none" angle="0" color="red" color2="red" colors="8519f fuchsia;.25 #8000ff;24903f #0040ff;.5 aqua;41287f #00ff40;.75 #0bed00;57671f yellow"></mxv:fill></mxv:rect></div>'),t.html('<div style="position: relative; width: 100%; height: 100%"><mxv:rect style="position: absolute; left: -1px; top: -1px; width: 101%; height: 101%" stroked="f" filled="t"><mxv:fill type="gradient" method="none" angle="270" color="#FFFFFF" opacity="100%" color2="#CC9A81" o:opacity2="0%"></mxv:fill></mxv:rect><mxv:rect style="position: absolute; left: 0px; top: 0px; width: 100%; height: 101%" stroked="f" filled="t"><mxv:fill type="gradient" method="none" angle="0" color="#000000" opacity="100%" color2="#CC9A81" o:opacity2="0%"></mxv:fill></mxv:rect></div>')},c={selected:"p52-2ed",cnt:"p52-cnt"},l=["d81e06","f4ea2a","1afa29","1296db","13227a","d4237a","ffffff","e6e6e6","dbdbdb","cdcdcd","bfbfbf","8a8a8a","707070","515151","2c2c2c","000000","ea986c","eeb174","f3ca7e","f9f28b","c8db8c","aad08f","87c38f","83c6c2","7dc5eb","87a7d6","8992c8","a686ba","bd8cbb","be8dbd","e89abe","e8989a","e16632","e98f36","efb336","f6ef37","afcd51","7cba59","36ab60","1baba8","17ace3","3f81c1","4f68b0","594d9c","82529d","a4579d","db649b","dd6572","d81e06","e0620d","ea9518","f4ea2a","8cbb1a","2ba515","0e932e","0c9890","1295db","0061b2","0061b0","004198","122179","88147f","d3227b","d6204b"],n=function(t,i,e){var o,s,d,a,p;t=t%360/60,p=e*i,a=p*(1-Math.abs(t%2-1)),o=s=d=e-p,t=~~t,o+=[p,a,0,0,a,p][t],s+=[a,p,p,a,0,0][t],d+=[0,0,a,p,p,a][t];var r=255*o,c=255*s,l=255*d;return{r:r,g:c,b:l,hex:"#"+(16777216|l|c<<8|r<<16).toString(16).slice(1)}},f=function(t,i,e){t/=255,i/=255,e/=255;var o,s,d,a;return d=Math.max(t,i,e),a=d-Math.min(t,i,e),o=0===a?null:d==t?(i-e)/a+(i<e?6:0):d==i?(e-t)/a+2:(t-i)/a+4,o=o%6*60,s=0===a?0:a/d,{h:o,s:s,v:d}};e.exports=o.View.extend({tmpl:{html:'<div mx-guid="g2" class="p52-b45" id="shortcuts_<%=$$.id%>"><ul mx-guid="g1">2</ul></div><div class="p52-551"><div class="p52-049"><div mx-guid="g3" class="p52-65b" id="cpicker_<%=$$.id%>" mx-click="colorZoneClick()"></div><div mx-guid="g4" class="p52-af0" id="ph_<%=$$.id%>" mx-mousedown="dragPicker()"></div></div><div class="p52-070"><div mx-guid="g5" class="p52-7c8" id="slide_<%=$$.id%>" mx-click="slideClick()"></div><div mx-guid="g6" class="p52-67d" mx-mousedown="dragSlide();" id="sh_<%=$$.id%>"></div></div></div><div class="p52-b18"><span mx-guid="g8" class="p52-0a0" id="bgcolor_<%=$$.id%>"></span><input mx-guid="g7" class="p5c-dc6" readonly="readonly" id="val_<%=$$.id%>"/><button class="pf0-btn pf0-046" type="button" mx-click="enter();">确定</button></div>',subs:[{s:"2",keys:["shortcuts","id"],tmpl:'<%for(var i=0;i<$$.shortcuts.length;i++){%><li id="sc_<%=$$.shortcuts[i]%>_<%=$$.id%>" style="background:#<%=$$.shortcuts[i]%>" mx-click="pickShortcuts({color:\'#<%=$$.shortcuts[i]%>\'})"></li><%}%>',path:'ul[mx-guid="g1"]'},{keys:["id"],path:'div[mx-guid="g2"]',attr:'id="shortcuts_<%=$$.id%>"',attrs:[{n:"id",p:1}]},{keys:["id"],path:'div[mx-guid="g3"]',attr:'id="cpicker_<%=$$.id%>"',attrs:[{n:"id",p:1}]},{keys:["id"],path:'div[mx-guid="g4"]',attr:'id="ph_<%=$$.id%>"',attrs:[{n:"id",p:1}]},{keys:["id"],path:'div[mx-guid="g5"]',attr:'id="slide_<%=$$.id%>"',attrs:[{n:"id",p:1}]},{keys:["id"],path:'div[mx-guid="g6"]',attr:'id="sh_<%=$$.id%>"',attrs:[{n:"id",p:1}]},{keys:["id"],path:'span[mx-guid="g8"]',attr:'id="bgcolor_<%=$$.id%>"',attrs:[{n:"id",p:1}]},{keys:["id"],path:'input[mx-guid="g7"]',attr:'id="val_<%=$$.id%>"',attrs:[{n:"id",p:1}]}]},init:function(t){var i=this;i.$color=t.color||"#ffffff",i.$hsv={h:0,s:1,v:1},s("#"+i.id).addClass(c.cnt)},render:function(){var t=this;t.updater.digest({id:t.id,shortcuts:l});var i=s("#slide_"+t.id),e=s("#cpicker_"+t.id);"SVG"==a?p(e,i):r(e,i),t.setColor(t.$color)},setHSV:function(t,i){var e=this,o=e.$hsv;o.h=t.h%360,o.s=t.s,o.v=t.v;var d=n(t.h,t.s,t.v),a=d.hex,p=s("#cpicker_"+e.id),r=n(t.h,1,1);if(p.css("background",r.hex),s("#bgcolor_"+e.id).css("background",a),s("#val_"+e.id).val(a),!i){s("#shortcuts_"+e.id+" li").removeClass(c.selected);var l=Math.round(196*o.h/360-8);s("#sh_"+e.id).css({top:l}),l=Math.round(196*(1-o.v)-6);var f=Math.round(196*o.s-6);s("#ph_"+e.id).css({left:f,top:l})}s("#sc_"+a.substr(1,6)+"_"+e.id).addClass(c.selected)},setColor:function(t){var i=this,e=parseInt(t.substr(1,2),16),o=parseInt(t.substr(3,2),16),s=parseInt(t.substr(5,2),16),d=f(e,o,s);i.setHSV(d)},"dragSlide<mousedown>":function(t){var i=this,e=s(t.eventTarget),o=parseInt(e.css("top"),10),a=t;d.begin(t.eventTarget,function(t){var s=t.pageY-a.pageY;s+=o,s<=-8?s=-8:s>=188&&(s=188),e.css({top:s});var d=(s+8)/196*360;i.setHSV({h:d,s:i.$hsv.s,v:i.$hsv.v},!0)})},"dragPicker<mousedown>":function(t){var i=this,e=s(t.eventTarget),o=parseInt(e.css("left"),10),a=parseInt(e.css("top"),10),p=t;d.begin(t.eventTarget,function(t){var s=t.pageY-p.pageY,d=t.pageX-p.pageX;s+=a,s<=-6?s=-6:s>=190&&(s=190),d+=o,d<=-6?d=-6:d>=190&&(d=190),e.css({top:s,left:d});var r=(d+6)/196,c=(196-(s+6))/196;i.setHSV({h:i.$hsv.h,s:r,v:c})})},"slideClick<click>":function(t){var i=this,e=s(t.eventTarget).offset(),o=t.pageY-e.top,d=o/196*360;i.setHSV({h:d,s:i.$hsv.s,v:i.$hsv.v})},"colorZoneClick<click>":function(t){var i=this,e=s(t.eventTarget).offset(),o=t.pageX-e.left,d=t.pageY-e.top,a=o/196,p=(196-d)/196;i.setHSV({h:i.$hsv.h,s:a,v:p})},"pickShortcuts<click>":function(t){this.setColor(t.params.color),s(t.eventTarget).addClass(c.selected)},"enter<click>":function(){var t=this,i=s("#val_"+t.id);s("#"+t.id).trigger({type:"pick",color:i.val()})}})});