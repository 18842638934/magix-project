define("app/gallery/mx-calendar/range",["magix","$","./index"],function(e,t,a){var i=e("magix"),d=e("$"),n=e("./index"),r=n.parse,s=n.format;i.applyStyle("pabcd3f",".pabcd3f-d9a{border:1px solid #e6e6e6;padding:15px 0;border-radius:4px;font-size:12px;background-color:#fff;width:250px}.pabcd3f-9be{padding:0 10px;margin-bottom:15px}.pabcd3f-b45{width:240px}.pabcd3f-st{height:24px;border-radius:4px;margin:0 10px 10px 0;width:70px;padding:4px;float:left;text-align:center;display:inline-block;cursor:pointer}.pabcd3f-st:hover{background:#eee}.pabcd3f-2ed,.pabcd3f-2ed:hover{color:#fff;background:#6363e6}.pabcd3f-ec7{padding:0 10px;margin-bottom:15px}.pabcd3f-ipt{background-color:#f0f0f0;border:0;height:24px;width:110px;text-align:center;display:inline-block;color:#333;border-radius:4px;box-sizing:border-box;padding:6px 9px}.pabcd3f-d14{border-top:1px solid #e6e6e6;padding-left:10px;padding-right:10px;padding-top:10px}");var c=function(e,t){t||(t=new Date);var a=new Date(t.getTime()+864e5*e);return a=a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate(),new Date(a)},o=c(0),p=c(-1),l=function(e){var t=c(-7),a=e-t.getDay();return{start:c(a,t),end:c(a+6,t)}},g=l(0),u=l(1),f=function(){var e=new Date(o.getFullYear(),o.getMonth()-1,1),t=e.getFullYear(),a=e.getMonth(),i=32-new Date(t,a,32).getDate();return{start:e,end:new Date(t,a,i)}}();f.text="上月",g.text="上周（周日至周六）",u.text="上周（周一至周日）";for(var h={today:{text:"今天",start:o,end:o},yesterday:{text:"昨天",start:p,end:p},preMonth:f,preWeekSun:g,preWeekMon:u,passedThisMonth:{text:"本月",start:c(1-o.getDate()),end:p},lastestThisMonth:{text:"本月",start:c(1-o.getDate()),end:o}},m=[2,6,13,14,29,89],x=0,k=void 0,$=void 0;x<m.length;x++)k=m[x],$=k+1,h["passed"+$]={text:"过去"+$+"天",start:c(-$),end:p},h["lastest"+$]={text:"最近"+$+"天",start:c(-k),end:o};var v=["preMonth","preWeekMon","preWeekSun","passedThisMonth","lastestThisMonth"],b=i.View.extend({tmpl:{html:'<div mx-guid="g9" class="pabcd3f-d9a">1</div>',subs:[{s:"1",keys:["quickDates"],tmpl:'<%if($$.quickDates.length){%><div class="pabcd3f-9be"><div class="pabcd16-03e">快捷日期</div><div mx-guid="g4" class="pabcd3f-b45 pabcd16-c8d">2</div></div><%}%><div class="pabcd3f-ec7"><div class="pabcd16-03e">日期范围</div><div class="pabcd16-c8d"><input mx-guid="g7" class="pabcd3f-ipt" data-hidden="<%=$$.dates.startStr%>" value="<%=$$.dates.startStr%>" mx-click="showDatepicker({first:true})" id="start_<%=$$.id%>" mx-change="sync()"/>-<input mx-guid="g8" class="pabcd3f-ipt" data-hidden="<%=$$.dates.endStr%>" value="<%=$$.dates.endStr%>" mx-click="showDatepicker()" id="end_<%=$$.id%>" mx-change="sync()"/></div></div><div class="pabcd3f-d14 pabcd16-c8d"><button mx-click="picked()" type="button" class="pabcdf0-btn pabcdf0-046">确定</button><button mx-click="cancel()" type="button" class="pabcdf0-btn pabcd16-ml5">取消</button></div>',path:'div[mx-guid="g9"]'},{s:"2",keys:["quickDatesMap","dates"],tmpl:'<%for(var i=0;i<$$.quickDates.length;i++){var key=$$.quickDates[i],info=$$.quickDatesMap[key]%><span class="pabcd3f-st<%if($$.dates.quickDateKey==key){%> pabcd3f-2ed<%}%>" mx-click="picked({quick:true,key:\'<%=key%>\'})"><%=info?info.text:key%></span><%}%>',path:'div[mx-guid="g4"]',pKeys:["quickDates"]},{keys:["dates","id"],path:'input[mx-guid="g7"]',pKeys:["quickDates"],attr:'data-hidden="<%=$$.dates.startStr%>" value="<%=$$.dates.startStr%>" mx-click="showDatepicker({first:true})" id="start_<%=$$.id%>"',attrs:[{n:"data-hidden"},{n:"value",q:1,p:1},{n:"mx-click"},{n:"id",p:1}]},{keys:["dates","id"],path:'input[mx-guid="g8"]',pKeys:["quickDates"],attr:'data-hidden="<%=$$.dates.endStr%>" value="<%=$$.dates.endStr%>" mx-click="showDatepicker()" id="end_<%=$$.id%>"',attrs:[{n:"data-hidden"},{n:"value",q:1,p:1},{n:"mx-click"},{n:"id",p:1}]}]},init:function(e){var t=this;t.$linkage=e.linkage,t.$min=e.min,t.$max=e.max,t.$dates=e.dates,t.$quickDates=e.quickDates||[],t.$placement=e.placement,t.$align=e.align},inside:function(e){var t=this,a=i.inside(e,t.id);if(!a)for(var d=t.owner.children(),n=d.length-1;n>=0;n--){var r=i.Vframe.get(d[n]);if(r&&(a=r.invoke("inside",e)),a)break}return a},render:function(){var e=this;e.updater.digest({id:e.id,quickDatesMap:h,quickDates:e.$quickDates,dates:e.$dates}),e.$node=d("#"+e.id)},"sync<change>":function(e){var t=this;e.stopPropagation(),d(e.eventTarget).data("hidden",e.date);var a=d("#start_"+t.id).data("hidden"),i=d("#end_"+t.id).data("hidden"),n=t.updater.get("dates"),s=r(a,n.formatter);r(i,n.formatter).getTime()<s.getTime()&&(i=a,d("#end_"+t.id).data("hidden",i)),n=b.getDescription(a,i,t.$quickDates),t.updater.digest({dates:n})},"showDatepicker<click>":function(e){var t=this,a=e.eventTarget,i=e.params,n={max:t.$max,min:t.$min,selected:a.value,placement:t.$placement,align:t.$align};i.first?t.$linkage&&(n.max=d("#end_"+t.id).data("hidden")):n.min=d("#start_"+t.id).data("hidden"),a.vframe?a.vframe.invoke("update",n):t.owner.mountVframe(a.id,"app/gallery/mx-calendar/datepicker",n).invoke("show")},"picked<click>":function(e){var t,a,i,n,r=this,c=e.params,o=r.updater,p=o.get("dates");if(c.quick){p.quickDateKey=c.key;var l=h[c.key];t=l.start,a=l.end,i=s(t,p.formatter),n=s(a,p.formatter),d("#start_"+r.id).data("hidden",i),d("#end_"+r.id).data("hidden",n),p.startStr=i,p.endStr=n,p.start=t,p.end=a,p.quickDateText=l.text,o.digest({dates:p})}else i=d("#start_"+r.id).data("hidden"),n=d("#end_"+r.id).data("hidden"),p=b.getDescription(i,n,r.$quickDates),o.digest({dates:p});r.$node.trigger({type:"change",dates:p})},"cancel<click>":function(){this.$node.trigger("cancel")}},{getSupportQuickDates:function(){return h},getDescription:function(e,t,a){e=r(e),t=r(t);var d,n={startStr:s(e,"yyyy-MM-dd"),endStr:s(t,"yyyy-MM-dd"),formatter:"yyyy-MM-dd"},c=o.getTime(),l=p.getTime(),g=e.getTime(),u=t.getTime();if(g==u)c==u?d="today":l==u&&(d="yesterday");else{var f=(u-g)/864e5+1;l==u?h[d="passed"+f]||(d=0):c==u&&(h[d="lastest"+f]||(d=0))}if(!d)for(var m=v.length-1;m>-1;m--){var x=v[m],k=h[x];if(u==k.end.getTime()&&g==k.start.getTime()){d=x;break}}return d&&a&&(i.toMap(a)[d]||(d=0)),d&&(n.quickDateText=h[d].text,n.quickDateKey=d),n}});a.exports=b}),define("app/gallery/mx-calendar/rangepicker",["magix","$","../mx-monitor/index","./index","./range"],function(e,t,a){var i=e("magix"),d=e("$"),n=e("../mx-monitor/index"),r=e("./index"),s=e("./range"),c=["today","yesterday","passed7","lastestThisMonth","preMonth","lastest15"],o=i.View.extend({init:function(e){var t=this,a=e.start,i=e.end,o=r.format(new Date,"YYYY-MM-dd");t.$fill=!0,a||(t.$fill=!1,a=o),i||(t.$fill=!1,i=o),t.$shortcuts="false"!=e.shortcuts,t.$linkage="false"!=e.linkage,t.$max=e.max,t.$min=e.min,t.$placement=e.placement,t.$align=e.align,t.$quickDates=t.$shortcuts?c:[],t.$dates=s.getDescription(a,i,t.$quickDates),n.setup();var p=d("#"+t.id),l=function(){t.show()};t.on("destroy",function(){n.teardown(),d("#rpcnt_"+t.id).remove(),p.off("click",l)}),p.on("click",l),t.$ownerNode=p},inside:function(e){var t=this,a=i.inside(e,t.id)||i.inside(e,"rpcnt_"+t.id);if(!a)for(var d=t.owner.children(),n=d.length-1;n>=0;n--){var r=i.Vframe.get(d[n]);if(r&&(a=r.invoke("inside",e)),a)break}return a},fill:function(){var e=this,t=e.$dates;t.quickDateText?e.$ownerNode.val(t.quickDateText):e.$ownerNode.val(t.startStr+"至"+t.endStr)},render:function(){var e=this,t="rpcnt_"+e.id;d(e.wrapEvent('<div mx-change="pickRange()" mx-cancel="hide()" style="position:absolute;display:none;z-index:10"></div>')).attr("id",t).insertAfter(e.$ownerNode),e.owner.mountVframe(t,"app/gallery/mx-calendar/range",{min:e.$min,max:e.$max,dates:e.$dates,linkage:e.$linkage,quickDates:e.$quickDates,placement:e.$placement,align:e.$align}),e.$fill&&e.fill()},show:function(){var e=this;if(!e.$shown){var t=d("#rpcnt_"+e.id),a=e.$ownerNode;e.$shown=!0,n.add(e),t.show();var i=a.offset(),r=void 0,s=void 0;switch(e.$placement){case"top":s=i.top-t.outerHeight()-5;break;default:s=i.top+a.outerHeight()+5}switch(e.$align){case"right":r=i.left+a.outerWidth()-t.outerWidth();break;default:r=i.left}t.offset({left:r,top:s})}},hide:function(){var e=this;if(e.$shown){var t=d("#rpcnt_"+e.id);e.$shown=!1,t.hide(),n.remove(e)}},"pickRange<change>":function(e){var t=this;e.stopPropagation(),t.$dates=e.dates,t.fill(),t.hide(),t.$ownerNode.trigger({type:"change",dates:e.dates})},"hide<cancel>":function(e){e.stopPropagation(),this.hide()}});a.exports=o});